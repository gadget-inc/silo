# Example config for Kubernetes deployment with Google Cloud Storage
# Uses K8s Lease-based coordination and GCS for object storage
# WAL is stored locally for low-latency writes, main data in GCS
#
# Environment Variable Substitution:
# Silo supports ${VAR} and ${VAR:-default} syntax in config values.
# This is useful for injecting Kubernetes Downward API values.

[server]
# Bind to all interfaces on port 7450
grpc_addr = "0.0.0.0:7450"

[coordination]
backend = "k8s"
cluster_prefix = "silo-prod"
lease_ttl_secs = 15

# IMPORTANT: advertised_grpc_addr is the address other nodes use to connect.
# In Kubernetes, use the pod IP (exposed via Downward API).
# If not set, defaults to grpc_addr which won't work if you bind to 0.0.0.0.
#
# Expose POD_IP in your deployment using the Downward API:
#   env:
#     - name: POD_IP
#       valueFrom:
#         fieldRef:
#           fieldPath: status.podIP
#
advertised_grpc_addr = "${POD_IP}:7450"

# Stable node identity for permanent shard leases.
# With StatefulSets, POD_NAME is stable across restarts (e.g., silo-0, silo-1),
# so a restarted pod automatically re-acquires its own shard leases.
# If not set, a random UUID is generated on each startup.
node_id = "${POD_NAME}"

[webui]
enabled = true
addr = "0.0.0.0:7460"

[database]
# Use GCS backend for Google Cloud Storage
# Credentials are read from GOOGLE_APPLICATION_CREDENTIALS or workload identity
backend = "gcs"
# NOTE: %shard% must be at a path boundary (after /) for split/clone to work correctly
path = "gs://my-bucket/silo/%shard%"

# Optional: Use local filesystem for WAL for lower write latency
# If omitted, WAL uses the same backend as the main store
[database.wal]
backend = "fs"
path = "/var/lib/silo/wal/%shard%"
